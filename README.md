# HearthTrice Manager
Менеджер для создания пользовательских Hearthstone карт для симулятора карточных настольных игр [Cockatrice](https://cockatrice.github.io/).

Платформа: Windows 10.

### Зависимости
##### Для корректной работы клиента необходимо установить следующие компоненты:
Отрисовка текста: [ImageMagick-7.1.1.](Dependencies/ImageMagick-7.1.1-27-Q16-HDRI-x64-dll.exe)



### Как пользоваться
Приложение может работать как с поддержкой хранилища, так и без него. Без хранилища доступен только функционал по созданию карт и экспорт изображений в .png формате. С поддержкой базы данных открывается возможность хранения всех созданных карт в библиотеке, создание колод, а также автоматическая генерация и экспорт .xml метаданных для Cockatrice. [Настройка хранилища.](#server-setup)

Генерация изображений карт:
1. Перейти в модуль редактора карт.
2. Заполнить метаданные
3. Импортировать изображение локально, перетянув его в поле превью, или из буфера обмена нажав по превью и вставив с помощью CTRL+V.
4. Сохранить как... (локально) или Загрузить в библиотеку (при поддержке хранилища)


Выгрузка изображений и .xml метаданных для Cockatrice:
1. Открыть настройкии указать корневую директорию Cockatrice.
2. Перейти в модуль библиотеки.
3. Экспорт библиотеки.

## Запуск
#### Виртуальное окружение
Требуется Python 3.10.x
```sh
python -m venv .venv
.venv\Scripts\activate
```

#### Библиотеки
```sh 
pip install -r requirements.txt
```

### Получение стандартных Hearthstone карт (опционально)
Чтобы добавить в хранилище коллекцию оригинальных карт из Hearthstone, необходимо получить API-ключ с сервиса [RapidAPI Hearthstone by omgvamp](https://rapidapi.com/omgvamp/api/hearthstone) и воспользоваться скриптом get_standard_cards.py. Изображения и метаданные для стандартных карт компилируются в ресурсный файл и хранятся вместе с клиентом. 
```sh
python ./src/utils/get_standard_cards.py
```
Скрипт необходимо дополнить личным API ключем и названиями сетов для скачивания (Classic, Naxxramas, и т.д.). После этого необходимо сгенерировать ресурсный файл.


### Генерация ресурсов

Основные ресурсные компоненты приложения: 
```sh 
pyrcc5 src\assets\resource_list.qrc -o src\resources.py
```
Ресурсы стандартной коллекции (при наличии):
```sh
pyrcc5 src\assets\resource_list_std.qrc -o src\resources_std.py
```
### Запуск

```sh
python ./src/main.py
```
Готово

## (опционально) Сборка в исполняемый файл  
```sh
python build.py
cd dist\
```

<a id="server-setup"></a>
## Для сервера
Для хранения карт и колод используется PostgreSQL. Формат таблиц см. в [Communication.py](src/Communication.py)

При отсутствии собственного удаленного сервера, есть возможность подключения через локальную сеть ([Radmin](https://www.radmin-vpn.com/), [Hamachi](https://vpn.net/)).




На устройстве-сервере с базой данных, необходимо открыть порт 5432 для входящих запросов. 
Для Windows 10:
Брандмауэр Защитника Windows -> Дополнительные параметры -> Правила для входящих подключений -> Создать правило -> Для порта TCP или UDP -> Протокол TCP, Порт 5432 -> Разрешить безопасное подключение.